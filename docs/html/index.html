<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Delay pedal with added FX: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Delay pedal with added FX
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Embedded Final Project - Spring 2014</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Delay pedal with added FX Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<p>FX pedals are an extremely popular industry, and as the performance of embedded devices becomes better and better, digital FX pedals are becoming increasingly popular. Most early FX pedals were analog, and many guitarists criticized digital pedals as sounding more "artificial" and "detached". However, the latest digital pedals produce FX that are currently impossible with analog circuits, and the sound quality of digital pedals is drastically improving. The goal of this project was to create a basic FX pedal using the Raspberry Pi and a Tiva C. The included FX are very simple, but serve as a proof of concept and demonstrate the power of the Raspberry Pi. More advanced FX could be produced if a dedicated DSP chip were used.</p>
<h1><a class="anchor" id="hardware"></a>
Hardware</h1>
<p>The pedal is built on a Raspberry Pi and uses a Tiva C for its user interface. On top of the Raspberry Pi sits a Wolfson audio card [1] with 1/8" input and output jacks. The Tiva C is hooked up to the Raspberry Pi's J8 header, which is used for serial interfaces. Pins PB0 (Rx) and PB1 (Tx) communicate over UART with the Tx and Rx pins on the Raspberry Pi. The Tiva C uses 2 buttons (SW1 and SW2) to capture user input and send the appropriate data to the Pi.</p>
<h1><a class="anchor" id="software"></a>
Software</h1>
<p>The Raspberry Pi is running a distribution of Raspbian issued by Wolfson [1]. This distribution contains the drivers that register the sound card as an ALSA device. ALSA is a framework for registering audio devices on a Linux computer that provides a common interface for reading and writing data to them [2]. On top of the ALSA library, the JACK Audio Connection Kit [3] provides an even more uniform API for communicating with the card. Once a JACK server is running, the user can select a frame size to balance computational requirements with latency. Every time a frame is received, a process function is called. The developer has access to a pointer to all of the samples in the frame, and can choose to do whatever he or she wants with these samples and then copies them to an output port.</p>
<h1><a class="anchor" id="uart"></a>
UART Controller</h1>
<p>The user interface is controlled by a Tiva C. The Tiva C is connected to the Raspberry Pi over UART. The Raspberry Pi reads the serial port to which the Tiva C sends UART data on a separate thread from the FX processor, in order to maintain uninterrupted, real-time audio processing.</p>
<p>The Tiva C has two buttons. The left button is used to cycle through the different FX, which are covered in the <a class="el" href="index.html#fx">FX Processor</a> section. The second button is used as a tap tempo. This is a commonly used control in FX pedals. The user can tap the button at the speed he/she wants the delay to occur. The controller will attempt to match the echo rate to the exact rate at which the button was pressed. Some rounding will occur due to the frame size, but this difference is usually unnoticeable. The controller will consider up to 4 most recent taps to calculate the tempo. If the button has not been pressed for more than 2 seconds, the tap tempo will start fresh.</p>
<h1><a class="anchor" id="delay"></a>
Delay Buffer</h1>
<p>Delay (or echo) is a common effect that guitarists use to create a repeated decaying echo of whatever they play. The delay effect creates an ambient sound that can really enhance a particular part of a song or solo. There are three main parameters that can change the way a delay sounds.</p>
<ul>
<li>Mix (or level) - determines how loud the delay is compared to the dry signal.</li>
<li>Decay - determines how quickly the signal will decay (or how many times it will repat)</li>
<li>Delay (or tempo) - determines the duration of time that passes before the signal repeats</li>
</ul>
<p>Adjusting these three parameters can create a wide variety of types of delay. A long delay with a fast decay rate can make it sound like two guitarists are playing the same song, but one of them is following the other. A short delay time with a medium decay rate can create a reverberation which is described in the <a class="el" href="index.html#reverb">reverb</a> section below. A long decay rate with a medium delay time and a low level can create an ambient background noise that sounds like a blend of all of the notes the guitarist is playing. There are several things guitarists can do with the delay effect, which is why it is one of the most popular effects out there. The delay effect in this project allows for other FX (described in the <a class="el" href="index.html#fx">FX Processor</a> section below) to be applied to the signal when it is repeated. The dry signal comes through clean, but the echo'd signals will have FX applied to them. Doing so can produce some unique sounds depending on how the guitar is played.</p>
<h1><a class="anchor" id="fx"></a>
FX Processor</h1>
<p>The FX Processor is responsible for processing audio on a sample by sample basis. The class defines one function, <code>process</code>, which processes audio on a sample-by-sample basis. The FX processing logic was separated from the delay buffer so that it can be used independently of the delay if desired. The following sections explain which FX the class is capable of processing.</p>
<h2><a class="anchor" id="overdrive"></a>
Overdrive</h2>
<p>Overdrive is a classic effect used to simulate tubes on an amplifier reaching their limit of amplification. This caused the tubes to round off the higher end of the audio coming through. The rounding causes slight distortion in the signal. The algorithm in this project uses a formula found in [4]. The equation is:</p>
<p>\(x=\frac{(1+k)x}{1+k*abs(x)}\) <br/>
 \(k=\frac{2a}{1-a}\) <br/>
 \(a=sin(\frac{drive+.01}{1.01}\frac{\pi}{2})\)</p>
<p>Where \(x\) is the sample, and \(drive\) is a value between 0 and 1, specifying how much overdrive is desired.</p>
<p>This algorith differs from hard distortion, which is described below.</p>
<h2><a class="anchor" id="distortion"></a>
Distortion</h2>
<p>Distortion is similar to overdrive, but generally has a harsher sound than overdrive. There are many different types of distortions, and they are generally made with analog circuits, but a simple algorithm is to simply amplify the signal and clip it. In this class, we multiply the signal (whose range is generally between -0.2 and 0.2) by a number from 1 to 5, and clip it at 0.2.</p>
<h2><a class="anchor" id="tremolo"></a>
Tremolo</h2>
<p>Tremolo is a technique used by instrumentalists where a single note was repeatedly picked, bowed, or played very quickly. The tremolo effect produces a similar sound on a sustained note by repeatedly cutting and restoring the volume of the output. This allows a player to simply hold a note and get the effect of tremolo without having to perform the technique.</p>
<h2><a class="anchor" id="reverb"></a>
Reverb</h2>
<p>Reverberation is a phenomenon know to occur in large rooms without much dampening (i.e. hard floors and walls). The phenomenon is observed when a loud sound occurs and bounces off the many surfaces in the room creating an echo. Usually, the sound will reach different surfaces at different times, creating a layered echoing effect that differs from delay. The effect was originally recreated by placing an amplifier in a large, undamped room, and recording the natural effect in that room. Afterwards, reverb units were placed in some amplifiers, which consisted of a spring that would vibrate as sound came through the amplifier [5]. A very simple digital reverb effect was created in cartoons by simply producing an echo with a very short repeat delay. That is the effect used in this class's reverb algorithm.</p>
<h2><a class="anchor" id="wah"></a>
Wah</h2>
<p>A wah effect simulates the natural filter that occurs from someones lips when they say the word "WAH". The mouth can be thought of as a moving bandpass filter which sweeps from low to high frequency. In this class's wah algorithm, a moving bandpass filter is generated using the following equations:</p>
<p>\(y_l(n) = F_1y_b(n) + y_l(n-1)\) <br/>
 \(y_b(n) = F_1y_h(n) + y_b(n-1)\) <br/>
 \(y_h(n) = x(n) - y_l(n-1) - Q_1y_b(n-1)\) <br/>
 \(F_1 = 2sin(\pi \frac{f_c}{f_s})\)</p>
<p>where \(Q_1\) determines the size of the pass band and is chosen to be 0.1 here [6].</p>
<ol type="1">
<li><a href="http://www.element14.com/community/community/raspberry-pi/raspberry-pi-accessories/wolfson_pi">http://www.element14.com/community/community/raspberry-pi/raspberry-pi-accessories/wolfson_pi</a></li>
<li><a href="http://www.alsa-project.org/main/index.php/Main_Page">http://www.alsa-project.org/main/index.php/Main_Page</a></li>
<li><a href="http://jackaudio.org">http://jackaudio.org</a></li>
<li><a href="http://ses.library.usyd.edu.au/bitstream/2123/7624/2/DESC9115_DAS_Assign02_310106370.pdf">http://ses.library.usyd.edu.au/bitstream/2123/7624/2/DESC9115_DAS_Assign02_310106370.pdf</a></li>
<li><a href="http://www.soundonsound.com/sos/Oct01/articles/advancedreverb1.asp">http://www.soundonsound.com/sos/Oct01/articles/advancedreverb1.asp</a></li>
<li><a href="http://www.cs.cf.ac.uk/Dave/CM0268/PDF/10_CM0268_Audio_FX.pdf">http://www.cs.cf.ac.uk/Dave/CM0268/PDF/10_CM0268_Audio_FX.pdf</a> </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 7 2014 16:20:53 for Delay pedal with added FX by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
